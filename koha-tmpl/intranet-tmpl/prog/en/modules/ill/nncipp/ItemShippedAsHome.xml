<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns1:NCIPMessage xmlns:ns1="http://www.niso.org/2008/ncip" ns1:version="http://www.niso.org/schemas/ncip/v2_02/ncip_v2_02.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.niso.org/2008/ncip http://www.niso.org/schemas/ncip/v2_02/ncip_v2_02.xsd">
    <!-- Usage in NNCIPP 1.0 is in use-case 2, call #6: Home library informs Owner library that the lended Item (is returned) and is shipped-->
    <ns1:ItemShipped>
        <!-- The InitiationHeader, stating from- and to-agency, is mandatory. -->
        <ns1:InitiationHeader>
            <!-- Home Library -->
            <ns1:FromAgencyId>
                <ns1:AgencyId>NO-[% FromAgency %]</ns1:AgencyId>
            </ns1:FromAgencyId>
            <!-- Owner Library -->
            <ns1:ToAgencyId>
                <ns1:AgencyId>NO-[% borrower.cardnumber %]</ns1:AgencyId>
            </ns1:ToAgencyId>
        </ns1:InitiationHeader>
        <!-- The RequestId must be the one created by the initializing AgencyId in call #1 -->
        <ns1:RequestId>
            <!-- The initializing AgencyId must be part of the RequestId -->
            <ns1:AgencyId>NO-[% FromAgency %]</ns1:AgencyId>
            <!-- The RequestIdentifierValue must be part of the RequestId-->
            <ns1:RequestIdentifierValue>[% RequestIdentifier %]</ns1:RequestIdentifierValue>
        </ns1:RequestId>
        <!-- The ItemId must uniquely identify the requested Item in the scope of the ToAgencyId -->
        <ns1:ItemId>
            <!-- All Items must have a scannable Id either a RFID or a Barcode or Both. -->
            <!-- In the case of both, start with the Barcode, use colon and no spaces as delimitor.-->
            <ns1:ItemIdentifierType>Barcode</ns1:ItemIdentifierType>
            <ns1:ItemIdentifierValue>[% ItemIdentifier %]</ns1:ItemIdentifierValue>
        </ns1:ItemId>
        <!-- The UserId must be uniqe in the scope of Home Library -->
        <ns1:UserId>
            <ns1:UserIdentifierValue>[% UserId %]</ns1:UserIdentifierValue>
        </ns1:UserId>
        <!-- DateShipped must conform to ISO 8601-2004, only using GMT)-->
        <ns1:DateShipped>[% DateShipped %]</ns1:DateShipped>
        <!-- Should be equal to AgencyAddressRoleType "Ship To" in LookupAgencyResponse -->
        <ns1:ShippingInformation>
            <ns1:PhysicalAddress>
                <ns1:StructuredAddress>
                    <ns1:Street>[% borrower.address | xml %]</ns1:Street>
                    <ns1:Region>[% borrower.city | xml %]</ns1:Region>
                    <ns1:Country>[% borrower.country | xml %]</ns1:Country>
                    <ns1:PostalCode>[% borrower.zipcode | xml %]</ns1:PostalCode>
                </ns1:StructuredAddress>
                <ns1:PhysicalAddressType/>
            </ns1:PhysicalAddress>
        </ns1:ShippingInformation>
        <!-- The following Ext is required by Alma -->
        <ns1:Ext>
        <!-- Who is shipping the item? -->
            <!-- if (FromAgencyId == RequestId.AgencyId) => Borrower/Home -->
            <ns1:NoticeContent>ShippedBy.Borrower</ns1:NoticeContent>
        </ns1:Ext>
    </ns1:ItemShipped>
</ns1:NCIPMessage>

