<!DOCTYPE html>
<html>
<head>
<title>[% IF ( deck )  %][% deck.name %] - Koha[% ELSE %]Koha digital signs[% END %]</title>
<meta name="generator" content="Koha [% Version %]" /> <!-- leave this for stats -->
<link rel="shortcut icon" href="[% IF ( OpacFavicon ) %][% OpacFavicon %][% ELSE %][% themelang %]/includes/favicon.ico[% END %]" type="image/x-icon" />
<meta name="viewport" content="width=device-width, initial-scale=1">
[% IF ( deck.webapp ) %]<meta name="apple-mobile-web-app-capable" content="yes" />[% END %]

[%# FIXME Use the JQM files from JQM in early stages of development, to be replaced with a local version later %]
[%# <script type="text/javascript" src="[% themelang % ]/lib/jquery/jquery.js"></script> %]
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.css" />
<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.js"></script>
</head>
<body>
[% IF ( enabled == 0 )  %]
  <p>Digital signs are not enabled!</p>
[% ELSE %]

  [%# Display a deck, all its signs and all records  %]
  [% IF ( deck )  %]

    [% IF ( signs.0 )  %]

      [%# Iterate through the signs, creating one front page for each %]
      [% FOREACH s IN signs %]

        <div data-role="page" id="sign_[% s.sign_id %]">
          <div data-role="header" data-position="fixed">
            <div style="text-align: center;">
            [% FOREACH sign IN signs %]
              <a href="#sign_[% sign.sign_id %]" data-role="button">[% sign.name %]</a>
            [% END %]
            </div>
          </div>
          <div data-role="content">
            <h1>[% s.name %]</h1>
            [% FOREACH r IN s.records %]
              <a href="#biblio_[% r.biblionumber %]" title="[% r.title %]"><img src="opac-cover.pl?biblionumber=[% r.biblionumber %]" style="border: 1px solid black; min-width: 150px; max-width: 150px; margin: 1em; padding: 1em;"></a>
            [% END %]
          </div>
          <div data-role="footer" data-position="fixed">
            <h4>Page Footer</h4>
          </div>
        </div>

        [% SET records = s.records %]
        [% FOREACH r IN s.records %]
          <div data-role="page" id="biblio_[% r.biblionumber %]" class="record">
            <div data-role="header" data-position="fixed">
              <div style="text-align: center;">
              [% FOREACH s IN signs %]
                <a href="#sign_[% s.sign_id %]" data-role="button">[% s.name %]</a>
              [% END %]
              </div>
            </div>
            <div data-role="content">
	            <h1>[% r.title %]</h1>
              <div class="coverimg"><img src="opac-cover.pl?biblionumber=[% r.biblionumber %]" style="border: 1px solid black; min-width: 150px; max-width: 150px; margin: 1em; padding: 1em;"></div>
              <div class="recorddescription">
              [%# Copy the MARC object from r.marc into record, to make it easier to write the template in the syspref %]
              [% SET record = r.marc %]
              [% recordtemplate | eval %]
              </div>
            </div>
            <div data-role="footer" data-position="fixed" style="text-align: center;">

              [%# First record %]
              [% IF ( loop.first ) %]
                <a href="#biblio_[% records.${loop.max}.biblionumber %]" data-role="button" data-inline="true" data-mini="true" data-iconpos="notext" data-icon="arrow-l"></a>
                <a href="#biblio_[% records.${loop.max}.biblionumber %]"><img src="opac-cover.pl?biblionumber=[% records.${loop.max}.biblionumber %]" style="max-height: 150px;"></a>
              [% ELSE %]
                <a href="#biblio_[% loop.prev.biblionumber %]" data-role="button" data-inline="true" data-mini="true" data-iconpos="notext" data-icon="arrow-l"></a>
                <a href="#biblio_[% loop.prev.biblionumber %]"><img src="opac-cover.pl?biblionumber=[% loop.prev.biblionumber %]" style="max-height: 150px;"></a>
              [% END %]

              [%# This record %]
              <img src="opac-cover.pl?biblionumber=[% r.biblionumber %]" style="max-height: 150px; border: 15px solid white;">

              [%# Last record %]
              [% IF ( loop.last ) %]
                <a href="#biblio_[% records.0.biblionumber %]"><img src="opac-cover.pl?biblionumber=[% records.0.biblionumber %]" style="max-height: 150px;"></a>
                <a href="#biblio_[% records.0.biblionumber %]" data-role="button" data-inline="true" data-mini="true" data-iconpos="notext" data-icon="arrow-r"></a>
              [% ELSE %]
                <a href="#biblio_[% loop.next.biblionumber %]"><img src="opac-cover.pl?biblionumber=[% loop.next.biblionumber %]" style="max-height: 150px;"></a>
                <a href="#biblio_[% loop.next.biblionumber %]" data-role="button" data-inline="true" data-mini="true" data-iconpos="notext" data-icon="arrow-r"></a>
              [% END %]

            </div>
          </div>
        [% END %]

      [% END %]

    [% ELSE %]
      <p>No signs attached to this deck.</p>
    [% END %]
  [% END %]

  [%# Display a list of all decks, as a default. Links use data-ajax="false" so decks will replace the first page, not be AJAXed in. %]
  [% IF ( decks )  %]
    <div data-role="page" id="alldecks">
      <div data-role="header" data-position="fixed">
        <h1>All decks</h1>
      </div>
      <div data-role="content">
        <ul data-role="listview">
        [% FOREACH d IN decks %]
          <li><a href="?deck=[% d.deck_id %]" data-ajax="false">[% d.name %]</a></li>
        [% END %]
        </ul>
      </div>
      <div data-role="footer" data-position="fixed">
        <h4>Page Footer</h4>
      </div>
    </div>
  [% END %]

[% END %]

</body>
</html>
